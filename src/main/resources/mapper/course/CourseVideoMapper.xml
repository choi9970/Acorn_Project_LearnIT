<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.learnit.learnit.course.repository.CourseVideoMapper">
    <select id="findById" resultType="CourseVideo">
        SELECT
            chapter_id,
            course_id,
            title,
            order_index,
            video_url,
            duration_sec
        FROM chapter
        WHERE chapter_id = #{chapterId}
    </select>

    <select id="selectPrevChapterId" resultType="Long">
        SELECT chapter_id
        FROM chapter
        WHERE course_id = #{courseId}
          AND order_index &lt; #{orderIndex}  ORDER BY order_index DESC
            LIMIT 1
    </select>

    <select id="selectNextChapterId" resultType="Long">
        SELECT chapter_id
        FROM chapter
        WHERE course_id = #{courseId}
          AND order_index &gt; #{orderIndex}  ORDER BY order_index ASC
            LIMIT 1
    </select>

    <insert id="insertOrUpdateStudyLog">
        INSERT INTO study_log (
            user_id,
            course_id,
            chapter_id,
            studied_sec,
            created_at
        ) VALUES (
                     #{userId},
                     #{courseId},
                     #{chapterId},
                     #{playTime},
                     NOW()
                 )
            ON DUPLICATE KEY UPDATE
                                 studied_sec = #{playTime},
                                 created_at = NOW()
    </insert>
</mapper>