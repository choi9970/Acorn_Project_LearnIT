<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/admin-layout :: layout(
        ~{::title},
        ~{::content},
        ~{::css}
      )}">

<th:block th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/admin/qna.css}">
</th:block>

<head>
    <title>Q&A 관리</title>
</head>

<body>
<section th:fragment="content">
    <div class="admin-qna-container">
        <h2>Q&A 관리</h2>

        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <!-- 필터 -->
        <div class="filters">
            <form method="get" action="/admin/qna" class="filter-form">
                <select name="type" class="filter-select">
                    <option value="">구분 전체</option>
                    <option value="LECTURE" th:selected="${currentType == 'LECTURE'}">강의 Q&A</option>
                    <option value="SITE" th:selected="${currentType == 'SITE'}">전체 Q&A</option>
                </select>

                <select name="status" class="filter-select">
                    <option value="">상태 전체</option>
                    <option value="ACTIVE" th:selected="${currentStatus == 'ACTIVE'}">ACTIVE(대기)</option>
                    <option value="PASS" th:selected="${currentStatus == 'PASS'}">PASS(처리)</option>
                </select>

                <input type="text" name="search" class="search-input"
                       placeholder="강의명/작성자/제목/내용 검색" th:value="${searchKeyword}">

                <input type="hidden" name="page" value="1">
                <input type="hidden" name="size" th:value="${pageSize}">

                <button type="submit" class="btn-search">검색</button>
                <a href="/admin/qna" class="btn-reset">초기화</a>
            </form>
        </div>

        <!-- 목록 -->
        <div class="table-wrap">
            <table class="qna-table">
                <thead>
                <tr>
                    <th>구분</th>
                    <th>Q&A번호</th>
                    <th>강좌ID</th>
                    <th>강좌명</th>
                    <th>작성자</th>
                    <th>Q&A 상태</th>
                    <th>요약</th>
                    <th>등록일</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="q : ${qnas}">
                    <td th:text="${q.typeLabel}">강의 Q&A</td>

                    <td>
                        <a class="link"
                           th:href="@{/admin/qna/{id}(id=${q.qnaId}, type=${currentType}, status=${currentStatus}, search=${searchKeyword}, page=${currentPage}, size=${pageSize})}"
                           th:text="${q.qnaId}">1</a>
                    </td>

                    <td th:text="${q.courseId != null ? q.courseId : '-'}">-</td>

                    <td>
                        <a class="link"
                           th:href="@{/admin/qna/{id}(id=${q.qnaId}, type=${currentType}, status=${currentStatus}, search=${searchKeyword}, page=${currentPage}, size=${pageSize})}"
                           th:text="${q.courseTitle != null ? q.courseTitle : '-'}">-</a>
                    </td>

                    <td th:text="${q.questionUserName}">작성자</td>

                    <td>
                        <span class="badge"
                              th:classappend="${q.statusLabel == 'ACTIVE'} ? 'badge-active' : 'badge-pass'"
                              th:text="${q.statusLabel}">
                        </span>
                    </td>

                    <td class="summary" th:text="${#strings.abbreviate(q.questionContent, 30)}">요약</td>

                    <td th:text="${q.questionCreatedAt != null ? #temporals.format(q.questionCreatedAt,'yyyy-MM-dd') : '-'}">-</td>
                </tr>

                <tr th:if="${qnas == null or #lists.isEmpty(qnas)}">
                    <td colspan="8" class="empty">Q&A가 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 페이징 -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 1}"
               th:href="@{/admin/qna(page=${currentPage-1}, size=${pageSize}, type=${currentType}, status=${currentStatus}, search=${searchKeyword})}"
               class="page-link">이전</a>

            <span th:each="i : ${#numbers.sequence(1,totalPages)}" class="page-number">
                <a th:if="${i != currentPage}"
                   th:href="@{/admin/qna(page=${i}, size=${pageSize}, type=${currentType}, status=${currentStatus}, search=${searchKeyword})}"
                   th:text="${i}">1</a>
                <strong th:if="${i == currentPage}" th:text="${i}">1</strong>
            </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/admin/qna(page=${currentPage+1}, size=${pageSize}, type=${currentType}, status=${currentStatus}, search=${searchKeyword})}"
               class="page-link">다음</a>
        </div>

        <div class="summary">
            총 <strong th:text="${totalCount}">0</strong>개
        </div>

    </div>
</section>
</body>
</html>
